## ubuntu22.04部署bitcoin全节点教程

最近铭文不是一般的火，动不动百八十倍，想快速低成本打个有潜力的铭文，没个自己的全节点怎么能行？借此缘故，本文重新整理下部署Bitcoin全节点的过程。

## 1\. 环境

硬盘：1T左右，优先NVME。Bitcoin截止本文发布时占610GB左右，保不准你后面还要部署闪电网络什么的，多给自己预留点空间。  
内存：16GB，查询历史记录什么的，要加载完整索引，需要的内存比较大  
cpu：这个目前常规cpu足够了，4核以上  
带宽：常规  
系统：ubuntu22.04  
同步时常：很多人说，需要3到5天；但我的只用了十几个小时，貌似是nvme盘+千兆带宽的缘故

## 2\. 基本部署

1.  下载btc程序最新版：[bitcoin](https://bitcoincore.org/en/download/) 根据自己系统环境选，我这里选的`Linux(tgz)`，amd的。当前我下载后的文件名是：`bitcoin-25.1-x86_64-linux-gnu.tar.gz`
2.  放在你合适的位置，我直接放`/root/`目录了，执行如下：

<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压</span></span><br><span class="line">tar -zxvf bitcoin-25.1-x86_64-linux-gnu.tar.gz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">改文件名</span></span><br><span class="line">mv bitcoin-25.1 bitcoin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入根目录</span></span><br><span class="line">cd bitcoin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改配置，具体配置内容查看下文</span></span><br><span class="line">vim bitcoin.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动节点，至此节点开始在后台自动同步了</span></span><br><span class="line">/root/bitcoin/bin/bitcoind -conf=/root/bitcoin/bitcoin.conf -daemon</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">停止节点，安全稳定的关闭节点。有说法是，不使用该命令，直接强制杀死bitcoin进程，可能导致数据异常，需要重新同步</span></span><br><span class="line">bitcoin-cli rpcuser=rpcuser -rpcpassword=rpcpassword stop</span><br></pre></td></tr></tbody></table>

常规配置内容

<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 节点数据目录</span><br><span class="line">datadir=/root/bitcoin/data/</span><br><span class="line">dbcache=4096</span><br><span class="line">txindex=1</span><br><span class="line">irc=1</span><br><span class="line">upnp=1</span><br><span class="line"># rpc连接账户</span><br><span class="line">rpcuser=username</span><br><span class="line"># rpc连接密码</span><br><span class="line">rpcpassword=password</span><br><span class="line">daemon=1</span><br><span class="line">server=1</span><br><span class="line">addressindex=1</span><br><span class="line">rest=1</span><br><span class="line">rpcbind=0.0.0.0:8332</span><br><span class="line">rpcallowip=0.0.0.0/0</span><br><span class="line"># 启用已废弃的rpc接口，这个具体咋用，还不确定</span><br><span class="line">deprecatedrpc=accounts</span><br></pre></td></tr></tbody></table>

## 3\. 进阶部署

上述的`基本部署`，只是满足了最低要求的部署方式，如果想要开机自启，能够快捷使用btc的不同命令，还需要进一步操作

1.  环境变量配置：

<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">新增内容</span></span><br><span class="line">export BTCPATH=/root/bitcoin/bin</span><br><span class="line">export PATH=$BTCPATH:$PATH</span><br></pre></td></tr></tbody></table>

2.  supervisor安装(守护进程，用于确保btc服务开机自启，异常重启等)

<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建日志目录，后续用到</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">mkdir</span> /root/bitcoin/logs/</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装</span></span><br><span class="line">sudo apt update &amp;&amp; sudo apt install supervisor</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置</span></span><br><span class="line">vim /etc/supervisor/conf.d/bitcoind.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置内容</span></span><br><span class="line">[program:bitcoind]</span><br><span class="line">command=/root/bitcoin/bin/bitcoind -conf=/root/bitcoin/bitcoin.conf -daemon</span><br><span class="line">numprocs=1</span><br><span class="line">directory=/root/bitcoin/</span><br><span class="line">autostart=true</span><br><span class="line">autorestart=true</span><br><span class="line">stdout_logfile=/root/bitcoin/logs/bitcoind.log</span><br><span class="line">stderr_logfile=/root/bitcoin/logs/bitcoind.error.log</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置完毕，回到命令行环境后，执行如下：</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">更新配置</span></span><br><span class="line">sudo supervisorctl reread</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">正式生效</span></span><br><span class="line">sudo supervisorctl update</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看状态</span></span><br><span class="line">sudo systemctl status supervisor  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">手动启动（可选）</span></span><br><span class="line">sudo supervisorctl start bitcoind</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">手动暂停（可选）</span></span><br><span class="line">sudo supervisorctl stop bitcoind</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">手动重启（可选）</span></span><br><span class="line">sudo supervisorctl restart bitcoind</span><br></pre></td></tr></tbody></table>

注：这里一个问题是，直接使用`supervisorctl`停止bitcoin，会不会导致数据异常，有待考证。正常情况下，是使用`bitcoin-cli`停止节点

## 4\. 查看日志和区块链浏览器

目前有两个位置的日志需要留意：

<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">supervisor的bitcoind控制台日志</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">正常启动后的日志，里面貌似没什么有效日志，就只有一行：Bitcoin Core starting</span></span><br><span class="line">tail -f /root/bitcoin/logs/bitcoind.log</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动异常的日志，各种缘故导致的启动异常，在这里都能看到原因</span></span><br><span class="line">tail -f /root/bitcoin/logs/bitcoind.error.log</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">bitcoin自身的日志文件，可以看到索引同步进度，节点数据同步情况等</span></span><br><span class="line">tail -f /root/bitcoin/data/debug.log</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可以看看数据同步多大了</span></span><br><span class="line">du -h /root/bitcoin/data/</span><br></pre></td></tr></tbody></table>

可以前往此处查看全网链的最新高度等信息：[btc区块链浏览器](https://explorer.btc.com/zh-CN)

## rpc访问

<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">账户密码要输对，输错了什么也不返回</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询mininginfo</span> </span><br><span class="line">curl -s -X POST --user rpcUserName:rpcPassword -H 'content-type: text/plain;' http://127.0.0.1:8332/ --data-binary '{"jsonrpc": "1.0", "id":"curltest", "method": "getmininginfo", "params": [] }'</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可进一步过滤获取最新高度</span></span><br><span class="line">curl -s -X POST --user rpcUserName:rpcPassword -H 'content-type: text/plain;' http://127.0.0.1:8332/ --data-binary '{"jsonrpc": "1.0", "id":"curltest", "method": "getmininginfo", "params": [] }' |awk -F '[:,]' '{print $3}' </span><br></pre></td></tr></tbody></table>

## 5\. 常用命令

<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">停止bitcoin节点</span></span><br><span class="line">bitcoin-cli rpcuser=rpcuser -rpcpassword=rpcpassword stop</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看网络状态：</span></span><br><span class="line">bitcoin-cli rpcuser=rpcuser -rpcpassword=rpcpassword getnetworkinfo</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看网络节点：</span></span><br><span class="line">bitcoin-cli rpcuser=rpcuser -rpcpassword=rpcpassword getpeerinfo</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看区块链信息：如同步进度、</span></span><br><span class="line">bitcoin-cli rpcuser=rpcuser -rpcpassword=rpcpassword getblockchaininfo</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看所有命令</span></span><br><span class="line">bitcoin-cli help</span><br></pre></td></tr></tbody></table>

## 6\. 总结

本文编辑完毕
